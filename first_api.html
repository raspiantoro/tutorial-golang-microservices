<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>API pertama kamu - Golang Microservices</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="pendahuluan.html">Pendahuluan</a></li><li class="chapter-item expanded affix "><a href="project_setup.html">Memulai Project Golang</a></li><li class="chapter-item expanded affix "><li class="part-title">Microservices</li><li class="chapter-item expanded "><a href="rest_api.html"><strong aria-hidden="true">1.</strong> REST API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="first_api.html" class="active"><strong aria-hidden="true">1.1.</strong> API pertama kamu</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Golang Microservices</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="api-pertama-kamu"><a class="header" href="#api-pertama-kamu">API pertama kamu</a></h1>
<p>Untuk memulai pengembangan REST API menggunakan Chi, kita perlu <em>meng-install</em> package chi pada service yang akan kita bangun. Pada chapter sebelumnya, kita sudah membuat satu service bernama product-svc. Sebelum <em>meng-install</em> chi, pastikan didalam terminal yang kamu gunakan sudah berada difolder product-svc, jalankan perintah berikut untuk berpindah dari root direktori workspace kamu</p>
<pre><code class="language-bash">cd ./product-svc
</code></pre>
<p>Jika kamu sudah berada didalam folder product-svc, ketikan perintah ini untuk meng-install chi kedalam service kamu.</p>
<pre><code class="language-bash">go get -u github.com/go-chi/chi/v5
</code></pre>
<p>Buka file main.go yang sudah kamu buat sebelumnya pada folder product-svc untuk <em>meng-import</em> package chi, json dan http</p>
<pre><code class="language-go">import (
    "encoding/json"
    "net/http"
	"github.com/go-chi/chi/v5"
)
</code></pre>
<p>Masih pada file main.go tambahkan baris code berikut untuk membuat type baru dengan nama ProductCategory.</p>
<pre><code class="language-go">type ProductCategory struct {
	ID   uint   `json:"id"`
	Name string `json:"name"`
}
</code></pre>
<p>Selanjutnya pada function main, kita perlu membuat chi router untuk <em>meng-handle</em> setiap requests yang datang dari users.</p>
<pre><code class="language-go">function main(){
    r := chi.NewRouter()
}
</code></pre>
<p>Baris diatas kita membuat satu instance router yang kita simpan didalam variable <code>r</code>. Selanjutnya kita perlu membuat endpoint <code>/api/product-category</code> dengan method GET untuk mengembalikan daftar kategori product kepada users. Tambahkan baris berikut setelah baris instansiasi chi router.</p>
<pre><code class="language-go">    r.Get("/api/product-category", func(w http.ResponseWriter, r *http.Request) {
		// langkah pertama
        categories := []ProductCategory{
			{
				ID:   1,
				Name: "Alat Tulis",
			},
			{
				ID:   2,
				Name: "Perlengkapan Rumah Tangga",
			},
			{
				ID:   3,
				Name: "Fashion",
			},
		}

        // langkah kedua
		result, err := json.Marshal(&amp;categories)
		if err != nil {
			w.WriteHeader(http.StatusInternalServerError)
			w.Write([]byte("Terjadi kesalahan pada server"))
			return
		}

        // langkah ketiga
		w.WriteHeader(http.StatusOK)
		w.Write(result)
	})
</code></pre>
<p>Pada baris kode diatas, kita membuat sebuah endpoint GET menggunakan method (function) Get dari chi router. Method Get pada chi router menerima dua parameter sebagai inputan, dimana parameter pertama berupa url path dari endpoint yang kita buat (<code>/api/product-category</code>), dan parameter kedua berupa closure (function) yang akan dieksekusi oleh chi untuk menghandle setiap request yang datang kepada path <code>/api/product-category</code>.</p>
<p>Terdapat tiga langkah yang kita tulis dalam closure yang kita buat untuk menangani requests dari users. Berikut penjelasan dari masing-masing langkah yang kita buat:</p>
<ol>
<li>Pada langkah pertama kita menyiapakan daftar kategori produk dengan menggunakan slice (saat ini kita membuat daftar kategori secara hardcoded, pada chapter integrasi dengan database kita akan belajar bagaimana menampilkan daftar produk yang ada di database)</li>
<li>Sebelum dapat mengembalikan slice daftar kategori kepada users, kita harus melakukan serialisasi (mengubah object menjadi rangkaian bytes) terlebih dahulu terhadap slice yang sudah kita buat. Untuk melakukannya kita menggunakan function <strong>Marshal</strong> dari package <strong>encoding/json</strong>. Function Marshal menerima parameter berupa pointer dari data yang akan kita serialisasi, dan function tersebut mengembalikan dua return value berupa byte slice dan error. Jika terdapat error pada saat melakukan serialisasi, kita akan mengembalikan <em>response</em> kepada user dengan status code <strong>500</strong> dan pesan kesalahan <strong>Terjadi kesalahan pada server</strong>. Selain itu kita juga melakukan <em>early return</em> saat terjadi error dengan tujuan mencegah agar kode pada langkah ketiga tidak ikut dieksekusi.</li>
<li>Jika proses serialisasi berhasil, kita akan mengembalikan <em>response</em> sukses kepada user dengan status code <strong>200</strong> dan daftar kategori produk dalam bentuk json.</li>
</ol>
<p>Selanjutnya kita perlu melakukan listen dan serve terhadap setiap request http yang datang. Tambahkan baris berikut pada function main</p>
<pre><code class="language-go">    fmt.Println("your server is running on port 8080")
	http.ListenAndServe(":8080", r)
</code></pre>
<p>Berikut adalah kode lengkap dari seluruh yang kita buat diatas</p>
<pre><code class="language-go">package main

import (
	"encoding/json"
	"fmt"
	"net/http"

	"github.com/go-chi/chi/v5"
)

type ProductCategory struct {
	ID   uint   `json:"id"`
	Name string `json:"name"`
}

func main() {
	r := chi.NewRouter()
	r.Get("/api/product-category", func(w http.ResponseWriter, r *http.Request) {
		categories := []ProductCategory{
			{
				ID:   1,
				Name: "Alat Tulis",
			},
			{
				ID:   2,
				Name: "Perlengkapan Rumah Tangga",
			},
			{
				ID:   3,
				Name: "Fashion",
			},
		}

		result, err := json.Marshal(&amp;categories)
		if err != nil {
			w.WriteHeader(http.StatusInternalServerError)
			w.Write([]byte("Terjadi kesalahan pada server"))
			return
		}

		w.WriteHeader(http.StatusOK)
		w.Write(result)
	})

	fmt.Println("your server is running on port 8080")
	http.ListenAndServe(":8080", r)
}
</code></pre>
<p>Ketik perintah berikut untuk menjalankan service melalui root folder worspace (./golang-marketplace) kamu</p>
<pre><code class="language-bash">go run ./product-svc
</code></pre>
<p>Kamu bisa menggunakan curl untuk melakukan testing terhadap endpoint yang sudah kamu buat</p>
<pre><code class="language-bash">curl http://localhost:8080/api/product-category
</code></pre>
<p>Berikut adalah response yang didapat dari endpoint yang sudah kita buat</p>
<pre><code>[{"id":1,"name":"Alat Tulis"},{"id":2,"name":"Perlengkapan Rumah Tangga"},{"id":3,"name":"Fashion"}]
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="rest_api.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="rest_api.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
